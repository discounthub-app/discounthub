# ‚öôÔ∏è –≠—Ç–∞–ø 1: –±–∏–ª–¥ —á–µ—Ä–µ–∑ Vite
FROM node:20 AS build

WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# üöÄ –≠—Ç–∞–ø 2: –ø—Ä–æ–¥–∞–∫—à–Ω —á–µ—Ä–µ–∑ nginx
FROM nginx:alpine AS prod

RUN rm -rf /etc/nginx/conf.d/default.conf
COPY --from=build /app/dist /usr/share/nginx/html

# üß™ –≠—Ç–∞–ø 3: dev-—Å–µ—Ä–≤–µ—Ä Vite (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ override)
FROM node:20 AS dev

WORKDIR /app
COPY package*.json ./

# ‚¨áÔ∏è –ó–¥–µ—Å—å –≥–ª–∞–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ NODE_ENV=development –∏ vite —è–≤–Ω–æ
ENV NODE_ENV=development
RUN npm install && npx vite --version

COPY . .

CMD ["npm", "run", "dev", "--", "--host"]
