from fastapi import FastAPI
from sqlalchemy.orm import Session
from sqlalchemy import text
from app.db import SessionLocal
from app.routers.discount import router as discount_router
from app.routers.seller import router as seller_router
from app.routers.user import router as user_router  # ‚úÖ –†–æ—É—Ç–µ—Ä –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

app = FastAPI()

# ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤
app.include_router(discount_router)
app.include_router(seller_router)
app.include_router(user_router)

# üîß –¢–µ—Å—Ç–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã API
@app.get("/ping")
def ping():
    return {"message": "pong"}

# üß™ –ü—Ä–∏–º–µ—Ä –ø—Ä—è–º–æ–≥–æ SQL-–∑–∞–ø—Ä–æ—Å–∞ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
@app.get("/users/raw")
def get_users():
    db: Session = SessionLocal()
    users = db.execute(text("SELECT id, username, email FROM users")).mappings().all()
    db.close()
    return users
